import type { Persona, Insight, DailyMetrics, LabResult, Protocol, DailyPlan } from '@/types'

export const RyanPersona: Persona = {
  id: 'Ryan',
  name: 'Ryan P.',
  avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=face',
  age: 34,
  archetype: 'The Pressure-Forged Pro',
  narrative: 'High performer struggling with sleep due to late workouts; Zone 2 success story',
  daysOfData: 45,
  devices: ['oura', 'fitbit', 'Vitals+-app', 'bloodwork', 'weather'],
  deviceConnections: [
    { deviceId: 'oura', isActive: true, firstConnected: '2024-10-15', lastRefreshed: '2025-01-11T04:30:00Z' },
    { deviceId: 'fitbit', isActive: false, firstConnected: '2024-08-20', lastRefreshed: '2024-11-05T12:00:00Z' },
    { deviceId: 'Vitals+-app', isActive: true, firstConnected: '2024-10-15', lastRefreshed: '2025-01-11T04:30:00Z' },
    { deviceId: 'bloodwork', isActive: true, firstConnected: '2024-10-15', lastRefreshed: '2025-01-11T04:30:00Z' },
    { deviceId: 'weather', isActive: true, firstConnected: '2024-10-15', lastRefreshed: '2025-01-11T04:30:00Z' },
  ],
  hasBloodwork: true,
  labDraws: 3,
  thresholds: {
    caffeineCutoff: '14:15',
    workoutEndTime: '19:00',
    bedroomTempCeiling: 22,
    eatingWindowHours: 10,
    minSleepHours: 7,
    maxAlcoholUnits: 2,
  },
  currentMetrics: {
    sleepScore: 65,
    deepSleepMin: 40,
    remSleepMin: 85,
    sleepLatencyMin: 22,
    hrv: 42,
    restingHr: 61,
    fastingGlucose: 104,
    weight: 175,
    trainingLoad: 'optimal',
  },
  tags: ['high-performer', 'sleep-issues', 'zone2-success'],
}

export const RyanInsights: Insight[] = [
  {
    id: 'Ryan-insight-001',
    personaId: 'Ryan',
    category: 'sleep',
    variableType: 'outcome',  // Sleep efficiency is a daily outcome
    title: 'BEDTIME HOUR â†’ SLEEP EFFICIENCY',
    headline: 'Late bedtimes are hurting your sleep efficiency',
    recommendation: 'Get to bed before 10:15 PM',
    explanation: 'Each hour after your threshold costs 2.3% efficiency',
    // NEW: Full causal parameters
    causalParams: {
      source: 'bedtime_hour',
      target: 'sleep_efficiency_pct',
      curveType: 'plateau_down',
      theta: {
        value: 22.25,
        unit: 'hour',
        low: 21.92,
        high: 22.58,
        displayValue: '10:15 PM',
      },
      betaBelow: {
        value: 0.1,
        unit: '%',
        description: '+0.1%/hr (stable)',
      },
      betaAbove: {
        value: -2.3,
        unit: '%',
        description: '-2.3%/hr (sharp drop)',
      },
      observations: 243,
      completePct: 99.2,
      changepointProb: 0.99,
      sizeCategory: 'large',
      currentValue: 23.5,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'bedtime_hour',
      threshold: '22:15',
      unit: 'time',
      direction: 'before',
    },
    outcome: {
      metric: 'sleep_efficiency',
      effect: '-2.3% per hour after threshold',
      direction: 'negative',
    },
    certainty: 0.94,
    evidence: {
      personalDays: 243,
      personalWeight: 0.89,
      populationWeight: 0.11,
      stability: 0.94,
    },
    dataSources: ['oura', 'apple-watch'],
    comparison: {
      before: { value: 78, label: 'After 11 PM' },
      after: { value: 89, label: 'Before 10:15 PM' },
    },
    whyNow: 'Your average bedtime shifted from 10:30 PM to 11:30 PM over the past 2 weeks.',
    holdoutPreview: {
      metric: 'sleep_efficiency',
      expectedChange: 5,
      unit: '%',
      horizon: '7 days',
    },
    showWork: 'On 156 nights when you went to bed before 10:15 PM, your sleep efficiency averaged 89%. On 87 nights after 11 PM, it dropped to 78%. This relationship held after controlling for alcohol, stress, and exercise. Your personal threshold (10:15 PM) is earlier than population average (11:00 PM).',
    actionable: true,
    priority: 1,
  },
  {
    id: 'Ryan-insight-002',
    personaId: 'Ryan',
    category: 'sleep',
    variableType: 'outcome',  // Deep sleep is a daily outcome
    title: 'ZONE 2 MINUTES â†’ DEEP SLEEP',
    headline: 'Zone 2 training is boosting your deep sleep',
    recommendation: 'Keep Zone 2 workouts under 52 minutes',
    explanation: '+3.8 seconds deep sleep per minute (up to threshold)',
    causalParams: {
      source: 'zone2_minutes',
      target: 'deep_seconds',
      curveType: 'plateau_up',
      theta: {
        value: 52,
        unit: 'minutes',
        low: 44.2,
        high: 59.8,
        displayValue: '52 min',
      },
      betaBelow: {
        value: 3.8,
        unit: 'sec',
        description: '+3.8 sec/min (strong)',
      },
      betaAbove: {
        value: 0.2,
        unit: 'sec',
        description: '+0.2 sec/min (diminishing)',
      },
      observations: 156,
      completePct: 94.9,
      changepointProb: 0.96,
      sizeCategory: 'medium',
      currentValue: 45,
      currentStatus: 'below_optimal',
    },
    cause: {
      behavior: 'zone2_minutes',
      threshold: 52,
      unit: 'minutes',
      direction: 'below',
    },
    outcome: {
      metric: 'deep_sleep_seconds',
      effect: '+3.8 sec per minute up to threshold',
      direction: 'positive',
    },
    certainty: 0.87,
    evidence: {
      personalDays: 156,
      personalWeight: 0.68,
      populationWeight: 0.32,
      stability: 0.89,
    },
    dataSources: ['garmin', 'oura'],
    comparison: {
      before: { value: 42, label: 'No Zone 2' },
      after: { value: 58, label: 'At threshold' },
    },
    whyNow: 'Your Zone 2 average increased to 45 minâ€”approaching your optimal threshold.',
    holdoutPreview: {
      metric: 'deep_sleep',
      expectedChange: 26,
      unit: 'seconds',
      horizon: '7 days',
    },
    showWork: 'On days with Zone 2 training, deep sleep increased by 3.8 seconds per minute trained, up to 52 minutes. Beyond that, returns diminish to +0.2 sec/min. Your optimal is 52 minutesâ€”more provides minimal additional benefit while increasing recovery demands.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'Ryan-insight-003',
    personaId: 'Ryan',
    category: 'sleep',
    variableType: 'outcome',  // REM sleep is a daily outcome
    title: 'ALCOHOL UNITS â†’ REM SLEEP',
    headline: 'Even moderate alcohol is destroying your REM',
    recommendation: 'Limit alcohol to half a drink for REM preservation',
    explanation: '-3.2% REM per unit above your threshold',
    causalParams: {
      source: 'alcohol_units',
      target: 'rem_sleep_pct',
      curveType: 'plateau_down',
      theta: {
        value: 0.5,
        unit: 'units',
        low: 0.28,
        high: 0.72,
        displayValue: '0.5 drinks',
      },
      betaBelow: {
        value: -0.8,
        unit: '%',
        description: '-0.8%/unit (mild)',
      },
      betaAbove: {
        value: -3.2,
        unit: '%',
        description: '-3.2%/unit (severe)',
      },
      observations: 167,
      completePct: 100,
      changepointProb: 0.88,
      sizeCategory: 'large',
      currentValue: 1.8,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'alcohol_units',
      threshold: 0.5,
      unit: 'drinks',
      direction: 'below',
    },
    outcome: {
      metric: 'rem_sleep_pct',
      effect: '-3.2% per drink above threshold',
      direction: 'negative',
    },
    certainty: 0.85,
    evidence: {
      personalDays: 167,
      personalWeight: 0.65,
      populationWeight: 0.35,
      stability: 0.90,
    },
    dataSources: ['oura'],
    comparison: {
      before: { value: 18, label: '2+ drinks' },
      after: { value: 24, label: '0-0.5 drinks' },
    },
    whyNow: 'Your REM percentage dropped 4% this weekâ€”coinciding with evening drinks.',
    holdoutPreview: {
      metric: 'rem_sleep_pct',
      expectedChange: 4,
      unit: '%',
      horizon: '5 days',
    },
    showWork: 'Your alcohol threshold is unusually low at 0.5 drinksâ€”you are alcohol-sensitive. On 89 nights with no alcohol, REM averaged 24%. On 78 nights with 2+ drinks, it dropped to 18%. Even one drink costs you ~2.7% REM.',
    actionable: true,
    priority: 1,
  },
  {
    id: 'Ryan-insight-004',
    personaId: 'Ryan',
    category: 'recovery',
    variableType: 'outcome',  // Next day HRV is a daily outcome
    title: 'ACUTE:CHRONIC RATIO â†’ NEXT DAY HRV',
    headline: 'Your training load ratio affects recovery',
    recommendation: 'Maintain training load ratio at 1.05',
    explanation: 'Deviation in either direction hurts HRV',
    causalParams: {
      source: 'acute_chronic_ratio',
      target: 'next_day_hrv',
      curveType: 'v_max',
      theta: {
        value: 1.05,
        unit: 'ratio',
        low: 0.9,
        high: 1.2,
        displayValue: '1.05',
      },
      betaBelow: {
        value: 2.3,
        unit: 'ms',
        description: '+2.3 ms/0.1 (undertraining)',
      },
      betaAbove: {
        value: -4.8,
        unit: 'ms',
        description: '-4.8 ms/0.1 (overtraining)',
      },
      observations: 134,
      completePct: 96.3,
      changepointProb: 0.97,
      sizeCategory: 'medium',
      currentValue: 1.08,
      currentStatus: 'at_optimal',
    },
    cause: {
      behavior: 'acute_chronic_ratio',
      threshold: 1.05,
      unit: 'ratio',
      direction: 'above',
    },
    outcome: {
      metric: 'next_day_hrv',
      effect: 'Â±4.8 ms per 0.1 deviation',
      direction: 'negative',
    },
    certainty: 0.86,
    evidence: {
      personalDays: 134,
      personalWeight: 0.73,
      populationWeight: 0.27,
      stability: 0.92,
    },
    dataSources: ['garmin', 'oura'],
    comparison: {
      before: { value: 38, label: 'ACR > 1.3' },
      after: { value: 52, label: 'ACR at 1.05' },
    },
    whyNow: 'Your ACR is at 1.08â€”in the optimal zone. Keep it there.',
    showWork: 'Your HRV peaks when ACR is between 0.9-1.2, with optimal at 1.05. Going above 1.2 (overtraining) costs 4.8 ms per 0.1 increase. Going below 0.9 (undertraining) costs 2.3 ms per 0.1 decrease. The penalty is asymmetricâ€”overtraining hurts more.',
    actionable: true,
    priority: 3,
  },
  {
    id: 'Ryan-insight-005',
    personaId: 'Ryan',
    category: 'sleep',
    variableType: 'outcome',  // Deep sleep is a daily outcome
    title: 'BEDROOM TEMP â†’ DEEP SLEEP',
    headline: 'Your bedroom temperature has an optimal sweet spot',
    recommendation: 'Set bedroom temperature to 18.5Â°C (65Â°F)',
    explanation: 'Both too cold and too warm reduce deep sleep',
    causalParams: {
      source: 'bedroom_temp_c',
      target: 'deep_sleep_pct',
      curveType: 'v_max',
      theta: {
        value: 18.5,
        unit: 'Â°C',
        low: 17.7,
        high: 19.3,
        displayValue: '18.5Â°C (65Â°F)',
      },
      betaBelow: {
        value: 0.8,
        unit: '%',
        description: '+0.8%/Â°C (toward optimal)',
      },
      betaAbove: {
        value: -1.2,
        unit: '%',
        description: '-1.2%/Â°C (too warm)',
      },
      observations: 142,
      completePct: 97.9,
      changepointProb: 0.89,
      sizeCategory: 'medium',
      currentValue: 21.5,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'bedroom_temp',
      threshold: 18.5,
      unit: 'celsius',
      direction: 'below',
    },
    outcome: {
      metric: 'deep_sleep_pct',
      effect: '-1.2% per Â°C above optimal',
      direction: 'negative',
    },
    certainty: 0.75,
    evidence: {
      personalDays: 142,
      personalWeight: 0.67,
      populationWeight: 0.33,
      stability: 0.82,
    },
    dataSources: ['oura', 'eight-sleep'],
    comparison: {
      before: { value: 15, label: 'At 22Â°C' },
      after: { value: 19, label: 'At 18.5Â°C' },
    },
    whyNow: 'Winter heating raised your bedroom to 21.5Â°Câ€”3Â°C above your optimal.',
    holdoutPreview: {
      metric: 'deep_sleep_pct',
      expectedChange: 3.6,
      unit: '%',
      horizon: '3 days',
    },
    showWork: 'Your deep sleep percentage peaks at 18.5Â°C. Going warmer costs 1.2% per degree. Going colder costs 0.8% per degree. At your current 21.5Â°C, you\'re losing ~3.6% deep sleep versus optimal.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'Ryan-insight-006',
    personaId: 'Ryan',
    category: 'sleep',
    variableType: 'outcome',  // Deep sleep is a daily outcome
    title: 'LAST MEAL HOUR â†’ DEEP SLEEP',
    headline: 'Late dinners are cutting into your deep sleep',
    recommendation: 'Finish eating before 7:30 PM',
    explanation: '-1.8% deep sleep per hour after threshold',
    causalParams: {
      source: 'last_meal_hour',
      target: 'deep_sleep_pct',
      curveType: 'plateau_down',
      theta: {
        value: 19.5,
        unit: 'hour',
        low: 18.7,
        high: 20.3,
        displayValue: '7:30 PM',
      },
      betaBelow: {
        value: 0.2,
        unit: '%',
        description: '+0.2%/hr (stable)',
      },
      betaAbove: {
        value: -1.8,
        unit: '%',
        description: '-1.8%/hr (drops fast)',
      },
      observations: 156,
      completePct: 98.7,
      changepointProb: 0.92,
      sizeCategory: 'medium',
      currentValue: 20.5,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'last_meal_hour',
      threshold: '19:30',
      unit: 'time',
      direction: 'before',
    },
    outcome: {
      metric: 'deep_sleep_pct',
      effect: '-1.8% per hour after threshold',
      direction: 'negative',
    },
    certainty: 0.82,
    evidence: {
      personalDays: 156,
      personalWeight: 0.71,
      populationWeight: 0.29,
      stability: 0.85,
    },
    dataSources: ['oura'],
    comparison: {
      before: { value: 16, label: 'Dinner at 9 PM' },
      after: { value: 19, label: 'Dinner by 7:30 PM' },
    },
    whyNow: 'Your average dinner time shifted to 8:30 PM this week.',
    holdoutPreview: {
      metric: 'deep_sleep_pct',
      expectedChange: 1.8,
      unit: '%',
      horizon: '5 days',
    },
    showWork: 'Eating after 7:30 PM costs 1.8% deep sleep per hour. Your current 8:30 PM average is costing you ~1.8% deep sleep versus eating by 7:30 PM. The effect is consistent across different meal sizes.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'Ryan-insight-007',
    personaId: 'Ryan',
    category: 'recovery',
    variableType: 'outcome',  // Weekly HRV variability is a short-term outcome
    title: 'SLEEP CONSISTENCY â†’ HRV VARIABILITY',
    headline: 'Inconsistent sleep times are destabilizing your HRV',
    recommendation: 'Maintain sleep consistency score at 85+',
    explanation: '-0.15 CV per point below threshold',
    causalParams: {
      source: 'sleep_consistency_score',
      target: 'weekly_hrv_cv',
      curveType: 'v_min',
      theta: {
        value: 85,
        unit: 'score',
        low: 78.8,
        high: 91.2,
        displayValue: '85 score',
      },
      betaBelow: {
        value: -0.15,
        unit: 'CV',
        description: '-0.15 CV/pt (improves toward Î¸)',
      },
      betaAbove: {
        value: -0.08,
        unit: 'CV',
        description: '-0.08 CV/pt (diminishing)',
      },
      observations: 198,
      completePct: 98,
      changepointProb: 0.91,
      sizeCategory: 'medium',
      currentValue: 72,
      currentStatus: 'below_optimal',
    },
    cause: {
      behavior: 'sleep_consistency',
      threshold: 85,
      unit: 'score',
      direction: 'above',
    },
    outcome: {
      metric: 'hrv_cv',
      effect: 'Lower CV = more stable HRV',
      direction: 'positive',
    },
    certainty: 0.78,
    evidence: {
      personalDays: 198,
      personalWeight: 0.81,
      populationWeight: 0.19,
      stability: 0.89,
    },
    dataSources: ['oura'],
    comparison: {
      before: { value: 18, label: 'Inconsistent (score 60)' },
      after: { value: 9, label: 'Consistent (score 85+)' },
    },
    whyNow: 'Your sleep consistency dropped to 72 this week due to weekend variability.',
    showWork: 'HRV variability (CV) decreases as sleep consistency improvesâ€”reaching optimal stability at score 85. Below 85, each point costs 0.15 CV. Your weekend sleep timing is 2+ hours different from weekdays, hurting your score.',
    actionable: true,
    priority: 3,
  },
  // BLOOD BIOMARKER INSIGHTS
  {
    id: 'Ryan-insight-008',
    personaId: 'Ryan',
    category: 'metabolic',
    variableType: 'marker',  // Fasting glucose is a slow-changing biomarker
    title: 'ZONE 2 MINUTES â†’ FASTING GLUCOSE',
    headline: 'Zone 2 cardio is lowering your fasting glucose',
    recommendation: 'Maintain 150+ Zone 2 minutes per week',
    explanation: '-0.8 mg/dL per 10 minutes above threshold',
    causalParams: {
      source: 'weekly_zone2_min',
      target: 'fasting_glucose_mgdl',
      curveType: 'plateau_down',
      theta: {
        value: 150,
        unit: 'min/week',
        low: 125,
        high: 175,
        displayValue: '150 min/week',
      },
      betaBelow: {
        value: 0.2,
        unit: 'mg/dL',
        description: '+0.2 mg/dL per 10min less',
      },
      betaAbove: {
        value: -0.8,
        unit: 'mg/dL',
        description: '-0.8 mg/dL per 10min more',
      },
      observations: 12,
      completePct: 100,
      changepointProb: 0.94,
      sizeCategory: 'large',
      currentValue: 180,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'weekly_zone2_minutes',
      threshold: 150,
      unit: 'minutes',
      direction: 'above',
    },
    outcome: {
      metric: 'fasting_glucose',
      effect: '-0.8 mg/dL per 10 minutes',
      direction: 'positive',
    },
    certainty: 0.91,
    evidence: {
      personalDays: 90,
      personalWeight: 0.45,
      populationWeight: 0.55,
      stability: 0.88,
    },
    dataSources: ['garmin', 'bloodwork'],
    comparison: {
      before: { value: 108, label: '<100 min/week' },
      after: { value: 98, label: '150+ min/week' },
    },
    whyNow: 'Your Zone 2 has increased to 180 min/weekâ€”glucose trending down.',
    holdoutPreview: {
      metric: 'fasting_glucose',
      expectedChange: -4,
      unit: 'mg/dL',
      horizon: '4 weeks',
    },
    showWork: 'Each 10 minutes of weekly Zone 2 above 150 min correlates with 0.8 mg/dL lower fasting glucose. Your increase from 120 to 180 min/week predicts a ~5 mg/dL improvement over 4-6 weeks. Population data strongly supports this relationship.',
    actionable: true,
    priority: 1,
  },
  {
    id: 'Ryan-insight-009',
    personaId: 'Ryan',
    category: 'metabolic',
    variableType: 'marker',  // Triglycerides are a slow-changing biomarker
    title: 'EATING WINDOW â†’ TRIGLYCERIDES',
    headline: 'Shorter eating windows correlate with lower triglycerides',
    recommendation: 'Keep eating window under 10 hours',
    explanation: '-8 mg/dL per hour reduction in window',
    causalParams: {
      source: 'eating_window_hours',
      target: 'triglycerides_mgdl',
      curveType: 'linear',
      theta: {
        value: 10,
        unit: 'hours',
        low: 8,
        high: 12,
        displayValue: '10 hours',
      },
      betaBelow: {
        value: -8,
        unit: 'mg/dL',
        description: '-8 mg/dL per hour shorter',
      },
      betaAbove: {
        value: 12,
        unit: 'mg/dL',
        description: '+12 mg/dL per hour longer',
      },
      observations: 8,
      completePct: 100,
      changepointProb: 0.87,
      sizeCategory: 'medium',
      currentValue: 11,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'eating_window',
      threshold: 10,
      unit: 'hours',
      direction: 'below',
    },
    outcome: {
      metric: 'triglycerides',
      effect: '-8 mg/dL per hour',
      direction: 'positive',
    },
    certainty: 0.88,
    evidence: {
      personalDays: 60,
      personalWeight: 0.38,
      populationWeight: 0.62,
      stability: 0.82,
    },
    dataSources: ['Vitals+-app', 'bloodwork'],
    comparison: {
      before: { value: 142, label: '14-hour window' },
      after: { value: 98, label: '10-hour window' },
    },
    whyNow: 'Your eating window averaged 11 hours this month.',
    holdoutPreview: {
      metric: 'triglycerides',
      expectedChange: -12,
      unit: 'mg/dL',
      horizon: '6 weeks',
    },
    showWork: 'Population research shows each hour reduction in eating window correlates with ~8 mg/dL lower triglycerides. Your personal data from 8 lab draws shows similar pattern. Reducing from 11 to 10 hours could lower your triglycerides by ~12 mg/dL.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'Ryan-insight-010',
    personaId: 'Ryan',
    category: 'metabolic',
    variableType: 'marker',  // HbA1c is a slow-changing biomarker (3-month average)
    title: 'SLEEP DURATION â†’ HBA1C',
    headline: 'Sleep under 7 hours is raising your HbA1c',
    recommendation: 'Get at least 7 hours of sleep',
    explanation: '+0.1% HbA1c per hour below threshold',
    causalParams: {
      source: 'avg_sleep_hours',
      target: 'hba1c_pct',
      curveType: 'plateau_up',
      theta: {
        value: 7,
        unit: 'hours',
        low: 6.5,
        high: 7.5,
        displayValue: '7 hours',
      },
      betaBelow: {
        value: 0.1,
        unit: '%',
        description: '+0.1% per hour less sleep',
      },
      betaAbove: {
        value: -0.02,
        unit: '%',
        description: '-0.02% per hour more (minimal)',
      },
      observations: 12,
      completePct: 100,
      changepointProb: 0.96,
      sizeCategory: 'large',
      currentValue: 6.2,
      currentStatus: 'below_optimal',
    },
    cause: {
      behavior: 'sleep_duration',
      threshold: 7,
      unit: 'hours',
      direction: 'above',
    },
    outcome: {
      metric: 'hba1c',
      effect: '+0.1% per hour below',
      direction: 'negative',
    },
    certainty: 0.93,
    evidence: {
      personalDays: 180,
      personalWeight: 0.52,
      populationWeight: 0.48,
      stability: 0.91,
    },
    dataSources: ['oura', 'bloodwork'],
    comparison: {
      before: { value: 5.8, label: '6 hours avg' },
      after: { value: 5.4, label: '7+ hours avg' },
    },
    whyNow: 'Your sleep average dropped to 6.2 hoursâ€”your HbA1c rose 0.2% last quarter.',
    holdoutPreview: {
      metric: 'hba1c',
      expectedChange: -0.08,
      unit: '%',
      horizon: '12 weeks',
    },
    showWork: 'Sleep deprivation impairs glucose regulation. Your data shows a clear threshold at 7 hoursâ€”below which HbA1c increases ~0.1% per hour of lost sleep. Getting back to 7 hours could reduce your HbA1c by 0.08% over 3 months.',
    actionable: true,
    priority: 1,
  },
  {
    id: 'Ryan-insight-011',
    personaId: 'Ryan',
    category: 'metabolic',
    variableType: 'marker',  // hsCRP is a slow-changing inflammation marker
    title: 'OMEGA-3 INTAKE â†’ HSCRP',
    headline: 'Fish oil supplementation is lowering your inflammation',
    recommendation: 'Continue 2g EPA+DHA daily',
    explanation: '-0.3 mg/L per gram above threshold',
    causalParams: {
      source: 'daily_omega3_g',
      target: 'hscrp_mgl',
      curveType: 'plateau_down',
      theta: {
        value: 2,
        unit: 'grams',
        low: 1.5,
        high: 2.5,
        displayValue: '2g EPA+DHA',
      },
      betaBelow: {
        value: 0.15,
        unit: 'mg/L',
        description: '+0.15 mg/L per gram less',
      },
      betaAbove: {
        value: -0.3,
        unit: 'mg/L',
        description: '-0.3 mg/L per gram more',
      },
      observations: 6,
      completePct: 100,
      changepointProb: 0.89,
      sizeCategory: 'medium',
      currentValue: 2.5,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'omega3_intake',
      threshold: 2,
      unit: 'grams',
      direction: 'above',
    },
    outcome: {
      metric: 'hscrp',
      effect: '-0.3 mg/L per gram',
      direction: 'positive',
    },
    certainty: 0.86,
    evidence: {
      personalDays: 120,
      personalWeight: 0.35,
      populationWeight: 0.65,
      stability: 0.79,
    },
    dataSources: ['Vitals+-app', 'bloodwork'],
    comparison: {
      before: { value: 2.1, label: 'No supplementation' },
      after: { value: 0.9, label: '2g+ daily' },
    },
    whyNow: 'Your hsCRP dropped from 2.1 to 0.9 since starting fish oil 4 months ago.',
    holdoutPreview: {
      metric: 'hscrp',
      expectedChange: -0.15,
      unit: 'mg/L',
      horizon: '8 weeks',
    },
    showWork: 'Omega-3 supplementation above 2g daily shows strong anti-inflammatory effects. Your hsCRP dropped 57% since starting supplementation. Population data confirms this effect size. Continuing at 2.5g maintains optimal levels.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'Ryan-insight-012',
    personaId: 'Ryan',
    category: 'cardio',
    variableType: 'marker',  // LDL cholesterol is a slow-changing biomarker
    title: 'RESTING HR TREND â†’ LDL CHOLESTEROL',
    headline: 'Lower resting HR correlates with improved LDL',
    recommendation: 'Maintain cardio to keep RHR under 60',
    explanation: '-2 mg/dL LDL per 1 bpm reduction',
    causalParams: {
      source: 'resting_hr_bpm',
      target: 'ldl_mgdl',
      curveType: 'linear',
      theta: {
        value: 60,
        unit: 'bpm',
        low: 55,
        high: 65,
        displayValue: '60 bpm',
      },
      betaBelow: {
        value: -2,
        unit: 'mg/dL',
        description: '-2 mg/dL per bpm lower',
      },
      betaAbove: {
        value: 3,
        unit: 'mg/dL',
        description: '+3 mg/dL per bpm higher',
      },
      observations: 12,
      completePct: 100,
      changepointProb: 0.92,
      sizeCategory: 'medium',
      currentValue: 61,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'resting_hr',
      threshold: 60,
      unit: 'bpm',
      direction: 'below',
    },
    outcome: {
      metric: 'ldl_cholesterol',
      effect: '-2 mg/dL per bpm',
      direction: 'positive',
    },
    certainty: 0.84,
    evidence: {
      personalDays: 270,
      personalWeight: 0.58,
      populationWeight: 0.42,
      stability: 0.86,
    },
    dataSources: ['oura', 'bloodwork'],
    comparison: {
      before: { value: 128, label: 'RHR 68 bpm' },
      after: { value: 112, label: 'RHR 60 bpm' },
    },
    whyNow: 'Your RHR dropped from 68 to 61 over the past 6 months with increased cardio.',
    holdoutPreview: {
      metric: 'ldl_cholesterol',
      expectedChange: -2,
      unit: 'mg/dL',
      horizon: '8 weeks',
    },
    showWork: 'Cardiovascular fitness (as measured by lower RHR) correlates with improved lipid profiles. Your 7 bpm RHR reduction correlated with a 16 mg/dL LDL improvement. Each additional bpm reduction predicts ~2 mg/dL further improvement.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'Ryan-insight-013',
    personaId: 'Ryan',
    category: 'metabolic',
    variableType: 'marker',  // HOMA-IR is a slow-changing insulin sensitivity marker
    title: 'STRENGTH TRAINING â†’ INSULIN SENSITIVITY (HOMA-IR)',
    headline: 'Resistance training is improving your insulin sensitivity',
    recommendation: 'Maintain 3+ strength sessions per week',
    explanation: '-0.15 HOMA-IR per weekly session',
    causalParams: {
      source: 'weekly_strength_sessions',
      target: 'homa_ir',
      curveType: 'plateau_down',
      theta: {
        value: 3,
        unit: 'sessions',
        low: 2,
        high: 4,
        displayValue: '3 sessions/week',
      },
      betaBelow: {
        value: 0.2,
        unit: 'HOMA-IR',
        description: '+0.2 per session less',
      },
      betaAbove: {
        value: -0.15,
        unit: 'HOMA-IR',
        description: '-0.15 per session more',
      },
      observations: 8,
      completePct: 100,
      changepointProb: 0.91,
      sizeCategory: 'large',
      currentValue: 3,
      currentStatus: 'at_optimal',
    },
    cause: {
      behavior: 'strength_training_frequency',
      threshold: 3,
      unit: 'sessions/week',
      direction: 'above',
    },
    outcome: {
      metric: 'homa_ir',
      effect: '-0.15 per session',
      direction: 'positive',
    },
    certainty: 0.89,
    evidence: {
      personalDays: 180,
      personalWeight: 0.42,
      populationWeight: 0.58,
      stability: 0.85,
    },
    dataSources: ['garmin', 'bloodwork'],
    comparison: {
      before: { value: 2.4, label: '1 session/week' },
      after: { value: 1.6, label: '3+ sessions/week' },
    },
    whyNow: 'Your HOMA-IR improved from 2.4 to 1.6 since increasing to 3 sessions/week.',
    holdoutPreview: {
      metric: 'homa_ir',
      expectedChange: 0,
      unit: '',
      horizon: 'maintain',
    },
    showWork: 'Resistance training increases muscle glucose uptake and improves insulin sensitivity. Your HOMA-IR dropped 33% after increasing from 1 to 3 weekly sessions. Population research confirms threshold effect at 3 sessions.',
    actionable: true,
    priority: 1,
  },
]

// Generate 45 days of metrics with narrative arc
function generateryanMetrics(): DailyMetrics[] {
  const metrics: DailyMetrics[] = []
  const startDate = new Date('2024-11-01')

  for (let i = 0; i < 45; i++) {
    const date = new Date(startDate)
    date.setDate(date.getDate() + i)
    const dateStr = date.toISOString().split('T')[0]

    // Narrative arc: Days 1-30 good, Days 31-40 work stress, Days 41-45 declining
    const isStressPhase = i >= 30 && i < 40
    const isDecliningPhase = i >= 40

    // Base values with daily variation
    const dayVariation = Math.sin(i * 0.5) * 5

    // Workout time shifts later during stress phase
    const workoutHour = isStressPhase || isDecliningPhase
      ? 19 + Math.floor(Math.random() * 2)  // 7-9 PM
      : 17 + Math.floor(Math.random() * 2)  // 5-7 PM
    const workoutTime = `${workoutHour.toString().padStart(2, '0')}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`

    // Caffeine timing also shifts later during stress
    const caffeineHour = isStressPhase || isDecliningPhase
      ? 14 + Math.floor(Math.random() * 3)  // 2-5 PM
      : 12 + Math.floor(Math.random() * 2)  // 12-2 PM
    const caffeineCutoff = `${caffeineHour.toString().padStart(2, '0')}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`

    // Sleep metrics degrade during stress
    const baseSleepScore = isDecliningPhase ? 62 : isStressPhase ? 68 : 78
    const baseSleepLatency = isDecliningPhase ? 24 : isStressPhase ? 18 : 11
    const baseDeepSleep = isDecliningPhase ? 38 : isStressPhase ? 45 : 58
    const baseHrv = isDecliningPhase ? 40 : isStressPhase ? 44 : 48

    // Bedroom temp rises with winter heating
    const bedroomTemp = i < 20 ? 19.5 + Math.random() : 21.5 + Math.random() * 2

    const metric: DailyMetrics = {
      date: dateStr,
      sleepScore: Math.round(baseSleepScore + dayVariation + Math.random() * 6),
      sleepDuration: Math.round(380 + Math.random() * 80 - (isStressPhase ? 40 : 0)),
      deepSleep: Math.round(baseDeepSleep + Math.random() * 10),
      remSleep: Math.round(75 + Math.random() * 25),
      lightSleep: Math.round(200 + Math.random() * 60),
      sleepLatency: Math.round(baseSleepLatency + Math.random() * 8),
      sleepEfficiency: 0.82 + Math.random() * 0.1 - (isStressPhase ? 0.05 : 0),
      bedtime: `${22 + Math.floor(Math.random() * 2)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
      wakeTime: `${6 + Math.floor(Math.random() * 2)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
      hrv: Math.round(baseHrv + Math.random() * 8),
      restingHr: Math.round(56 + Math.random() * 8 + (isStressPhase ? 4 : 0)),
      respiratoryRate: 13.5 + Math.random() * 1.5,
      bodyTemp: -0.2 + Math.random() * 0.4,
      steps: Math.round(7000 + Math.random() * 5000),
      activeCalories: Math.round(350 + Math.random() * 250),
      moderateMinutes: Math.round(20 + Math.random() * 30),
      vigorousMinutes: Math.round(15 + Math.random() * 25),
      zone2Minutes: Math.round(25 + Math.random() * 20),
      trainingLoad: Math.round(60 + Math.random() * 40),
      caffeineCutoff: caffeineCutoff,
      alcoholUnits: Math.random() > 0.7 ? Math.floor(Math.random() * 3) : 0,
      eatingWindowStart: '07:30',
      eatingWindowEnd: `${17 + Math.floor(Math.random() * 3)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
      bedroomTemp: Math.round(bedroomTemp * 10) / 10,
      workoutTime: Math.random() > 0.15 ? workoutTime : null,
      workoutType: Math.random() > 0.15 ? ['strength', 'cardio', 'hiit', 'zone2'][Math.floor(Math.random() * 4)] : null,
      mood: Math.round(4 + Math.random() * 2 - (isStressPhase ? 1 : 0)),
      energy: Math.round(4 + Math.random() * 2 - (isStressPhase ? 1 : 0)),
      focus: Math.round(4 + Math.random() * 2 - (isStressPhase ? 1 : 0)),
      stress: Math.round(3 + Math.random() * 2 + (isStressPhase ? 2 : 0)),
      events: isStressPhase && Math.random() > 0.5 ? ['late_work'] : undefined,
    }

    metrics.push(metric)
  }

  return metrics
}

export const ryanMetrics: DailyMetrics[] = generateryanMetrics()

export const RyanLabs: LabResult[] = [
  {
    date: '2024-10-15',
    fastingGlucose: 92,
    hba1c: 5.2,
    totalCholesterol: 195,
    ldl: 118,
    hdl: 52,
    triglycerides: 156,
    hsCrp: 1.8,
    vitaminD: 42,
    testosterone: 487,
  },
  {
    date: '2024-11-20',
    fastingGlucose: 95,
    hba1c: 5.2,
    totalCholesterol: 188,
    ldl: 112,
    hdl: 54,
    triglycerides: 142,
    hsCrp: 1.5,
    vitaminD: 45,
    testosterone: 545,
  },
  {
    date: '2024-12-28',
    fastingGlucose: 104,
    hba1c: 5.3,
    totalCholesterol: 182,
    ldl: 108,
    hdl: 55,
    triglycerides: 131,
    hsCrp: 1.4,
    vitaminD: 48,
    testosterone: 612,
  },
]

export const RyanProtocols: Protocol[] = [
  {
    id: 'Ryan-protocol-sleep',
    personaId: 'Ryan',
    name: 'Sleep Efficiency Protocol',
    description: 'Optimize sleep efficiency based on your personal thresholds',
    category: 'sleep',
    status: 'active',
    outcome: 'sleep_efficiency',
    baseline: {
      value: 0.78,
      unit: 'efficiency',
    },
    actions: [
      {
        id: 'action-bedtime',
        label: 'In bed by 10:15 PM',
        category: 'sleep',
        isActive: true,
        impact: 0.06,
        actionType: 'cutoff',
        time: '10:15 PM',
        linkedInsightId: 'Ryan-insight-001',
      },
      {
        id: 'action-caffeine',
        label: 'No caffeine after 2:15 PM',
        category: 'sleep',
        isActive: true,
        impact: 0.04,
        actionType: 'cutoff',
        time: '2:15 PM',
      },
      {
        id: 'action-workout-time',
        label: 'Finish workouts by 7:00 PM',
        category: 'sleep',
        isActive: false,
        impact: 0.05,
        actionType: 'cutoff',
        time: '7:00 PM',
      },
      {
        id: 'action-last-meal',
        label: 'Last meal by 7:30 PM',
        category: 'sleep',
        isActive: true,
        impact: 0.03,
        actionType: 'cutoff',
        time: '7:30 PM',
        linkedInsightId: 'Ryan-insight-006',
      },
      {
        id: 'action-bedroom-temp',
        label: 'Set bedroom to 18.5Â°C',
        category: 'sleep',
        isActive: false,
        impact: 0.04,
        actionType: 'target',
        linkedInsightId: 'Ryan-insight-005',
      },
      {
        id: 'action-alcohol',
        label: 'Limit to 0.5 drinks',
        category: 'sleep',
        isActive: false,
        impact: 0.03,
        actionType: 'target',
        linkedInsightId: 'Ryan-insight-003',
      },
      {
        id: 'action-zone2-workout',
        label: 'Zone 2 Cardio (45-52 min)',
        category: 'activity',
        isActive: true,
        impact: 0.05,
        actionType: 'duration',
        startTime: '5:00 PM',
        endTime: '6:00 PM',
        linkedInsightId: 'Ryan-insight-002',
      },
      {
        id: 'action-post-dinner-walk',
        label: 'Post-Dinner Walk (15 min)',
        category: 'activity',
        isActive: true,
        impact: 0.03,
        actionType: 'duration',
        startTime: '7:45 PM',
        endTime: '8:00 PM',
        linkedInsightId: 'Ryan-insight-006',
      },
    ],
    states: [
      { id: 'state-high-strain', label: 'High strain day', isActive: false },
      { id: 'state-travel', label: 'Travel day', isActive: false },
      { id: 'state-deadline', label: 'Work deadline', isActive: true },
    ],
    triggers: [
      {
        if: ['state-high-strain'],
        then: ['action-caffeine', 'action-workout-time'],
        reason: 'High strain increases sleep pressure, making timing even more critical',
      },
      {
        if: ['state-deadline'],
        then: ['action-caffeine', 'action-bedtime'],
        reason: 'Deadlines often lead to late caffeine and delayed bedtime',
      },
    ],
    simulator: {
      deltas: {
        'action-bedtime': 0.06,
        'action-caffeine': 0.04,
        'action-workout-time': 0.05,
        'action-last-meal': 0.03,
        'action-bedroom-temp': 0.04,
        'action-alcohol': 0.03,
      },
    },
    evidenceLevel: 89,
    difficulty: 2,
  },
  {
    id: 'Ryan-protocol-zone2',
    personaId: 'Ryan',
    name: 'Deep Sleep Optimizer',
    description: 'Maximize deep sleep through Zone 2 training',
    category: 'sleep',
    status: 'active',
    outcome: 'deep_sleep_minutes',
    baseline: {
      value: 42,
      unit: 'minutes',
    },
    actions: [
      {
        id: 'action-zone2-duration',
        label: '45-52 min Zone 2 cardio',
        category: 'activity',
        isActive: true,
        impact: 12,
        actionType: 'duration',
        linkedInsightId: 'Ryan-insight-002',
      },
      {
        id: 'action-zone2-timing',
        label: 'Zone 2 before 5:00 PM',
        category: 'activity',
        isActive: true,
        impact: 4,
        actionType: 'cutoff',
        time: '5:00 PM',
      },
    ],
    states: [
      { id: 'state-recovery-day', label: 'Recovery day', isActive: false },
    ],
    triggers: [
      {
        if: ['state-recovery-day'],
        then: [],
        reason: 'Skip Zone 2 on recovery days',
      },
    ],
    simulator: {
      deltas: {
        'action-zone2-duration': 12,
        'action-zone2-timing': 4,
      },
    },
    evidenceLevel: 87,
    difficulty: 3,
  },
  {
    id: 'Ryan-protocol-glucose',
    personaId: 'Ryan',
    name: 'Glucose Optimization Protocol',
    description: 'Lower fasting glucose through exercise and meal timing',
    category: 'metabolic',
    status: 'active',
    outcome: 'fasting_glucose',
    baseline: {
      value: 104,
      unit: 'mg/dL',
    },
    actions: [
      {
        id: 'action-weekly-zone2',
        label: '150+ min Zone 2 per week',
        category: 'activity',
        isActive: true,
        impact: -6,
        actionType: 'duration',
        linkedInsightId: 'Ryan-insight-008',
      },
      {
        id: 'action-eating-window',
        label: '10-hour eating window',
        category: 'metabolic',
        isActive: true,
        impact: -4,
        actionType: 'duration',
        linkedInsightId: 'Ryan-insight-009',
      },
      {
        id: 'action-sleep-7hrs',
        label: 'Get 7+ hours sleep',
        category: 'sleep',
        isActive: false,
        impact: -3,
        actionType: 'target',
        linkedInsightId: 'Ryan-insight-010',
      },
      {
        id: 'action-strength-3x',
        label: '3x strength training per week',
        category: 'activity',
        isActive: true,
        impact: -5,
        actionType: 'duration',
        linkedInsightId: 'Ryan-insight-013',
      },
    ],
    states: [
      { id: 'state-travel', label: 'Travel week', isActive: false },
    ],
    triggers: [
      {
        if: ['state-travel'],
        then: ['action-eating-window'],
        reason: 'Eating window is portable even when traveling',
      },
    ],
    simulator: {
      deltas: {
        'action-weekly-zone2': -6,
        'action-eating-window': -4,
        'action-sleep-7hrs': -3,
        'action-strength-3x': -5,
      },
    },
    evidenceLevel: 91,
    difficulty: 3,
  },
  {
    id: 'Ryan-protocol-inflammation',
    personaId: 'Ryan',
    name: 'Inflammation Control',
    description: 'Reduce hsCRP through supplementation and cardio',
    category: 'metabolic',
    status: 'suggested',
    outcome: 'hscrp',
    baseline: {
      value: 1.4,
      unit: 'mg/L',
    },
    actions: [
      {
        id: 'action-omega3',
        label: '2g EPA+DHA daily',
        category: 'metabolic',
        isActive: true,
        impact: -0.5,
        actionType: 'target',
        linkedInsightId: 'Ryan-insight-011',
      },
      {
        id: 'action-rhr-cardio',
        label: 'Cardio to lower RHR to 60',
        category: 'cardio',
        isActive: false,
        impact: -0.2,
        actionType: 'target',
        linkedInsightId: 'Ryan-insight-012',
      },
    ],
    states: [],
    triggers: [],
    simulator: {
      deltas: {
        'action-omega3': -0.5,
        'action-rhr-cardio': -0.2,
      },
    },
    evidenceLevel: 86,
    difficulty: 2,
  },
]

export const RyanDailyPlan: DailyPlan = {
  personaId: 'Ryan',
  date: new Date().toISOString().split('T')[0],
  greeting: 'Good morning, Ryan. Your HRV was 42ms last nightâ€”below your baseline. Let\'s focus on recovery today.',
  priorities: {
    high: [
      {
        id: 'plan-001',
        text: 'Finish workouts before 7 PM',
        explanation: 'Your late workouts are adding 10+ minutes to your sleep latency',
        evidenceWeight: '89% your data, 11% population',
        status: 'pending',
      },
      {
        id: 'plan-002',
        text: 'No caffeine after 2:15 PM',
        explanation: 'Late caffeine is suppressing your overnight HRV by 8ms',
        evidenceWeight: '84% your data, 16% population',
        status: 'pending',
      },
    ],
    moderate: [
      {
        id: 'plan-003',
        text: 'Set bedroom to 19Â°C tonight',
        explanation: 'Cooler temps correlate with +14 min deep sleep for you',
        evidenceWeight: '76% your data, 24% population',
        status: 'pending',
      },
      {
        id: 'plan-004',
        text: 'Get 30+ min Zone 2 cardio',
        explanation: 'You\'re on track for 175 min/weekâ€”keep it up for lipid benefits',
        evidenceWeight: '55% your data, 45% population',
        status: 'pending',
      },
    ],
    maintain: [
      {
        id: 'plan-005',
        text: 'Keep eating window to 10 hours',
        explanation: 'Your current window is working well for glucose control',
        evidenceWeight: '70% your data, 30% population',
        status: 'pending',
      },
    ],
  },
  eveningCheckIn: {
    completed: [],
    pending: [],
    prediction: {
      sleepScore: 72,
      deepSleep: 48,
      sleepLatency: 14,
      confidence: 0.78,
    },
  },
}
