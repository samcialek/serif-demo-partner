import type { Persona, Insight, DailyMetrics, LabResult, Protocol, DailyPlan } from '@/types'

export const sarahPersona: Persona = {
  id: 'sarah',
  name: 'Sarah M.',
  avatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=150&h=150&fit=crop&crop=face',
  age: 41,
  archetype: 'The Metabolic Optimizer',
  narrative: 'Pre-diabetic turned success story; reversed glucose trends through lifestyle changes',
  daysOfData: 90,
  devices: ['oura', 'fitbit', 'Vitals+-app', 'bloodwork', 'weather'],
  deviceConnections: [
    { deviceId: 'oura', isActive: true, firstConnected: '2024-07-01', lastRefreshed: '2025-01-11T04:30:00Z' },
    { deviceId: 'fitbit', isActive: false, firstConnected: '2024-05-10', lastRefreshed: '2024-09-20T08:00:00Z' },
    { deviceId: 'Vitals+-app', isActive: true, firstConnected: '2024-07-01', lastRefreshed: '2025-01-11T04:30:00Z' },
    { deviceId: 'bloodwork', isActive: true, firstConnected: '2024-07-01', lastRefreshed: '2025-01-11T04:30:00Z' },
    { deviceId: 'weather', isActive: true, firstConnected: '2024-07-01', lastRefreshed: '2025-01-11T04:30:00Z' },
  ],
  hasBloodwork: true,
  labDraws: 4,
  thresholds: {
    caffeineCutoff: '16:30',      // Different from Ryan - slower metabolizer
    workoutEndTime: '20:00',      // Can handle later workouts
    bedroomTempCeiling: 19,       // More sensitive to heat
    eatingWindowHours: 8,         // Tighter eating window for glucose
    minSleepHours: 7.5,
    maxAlcoholUnits: 1,
  },
  currentMetrics: {
    sleepScore: 82,
    deepSleepMin: 55,
    remSleepMin: 95,
    sleepLatencyMin: 9,
    hrv: 52,
    restingHr: 54,
    fastingGlucose: 94,           // Improved from 118
    weight: 145,
    trainingLoad: 'optimal',
  },
  tags: ['metabolic-success', 'cgm-user', 'consistency-champion'],
}

export const sarahInsights: Insight[] = [
  {
    id: 'sarah-insight-001',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // Fasting glucose trend is a slow-changing marker
    title: 'EATING WINDOW â†’ FASTING GLUCOSE',
    headline: 'Your 8-hour eating window is transforming your glucose',
    recommendation: 'Maintain 8-hour eating window (10 AM - 6 PM)',
    explanation: 'Time-restricted eating reduced your fasting glucose by 24 mg/dL',
    cause: {
      behavior: 'eating_window',
      threshold: 8,
      unit: 'hours',
      direction: 'below',
    },
    populationThreshold: {
      value: 12,
      label: 'Typical Eating Window',
      variance: '4 hours shorter than typical',
    },
    outcome: {
      metric: 'fasting_glucose',
      effect: '-24 mg/dL from baseline',
      direction: 'positive',
    },
    certainty: 0.93,
    evidence: {
      personalDays: 87,
      personalWeight: 0.93,
      populationWeight: 0.07,
      stability: 0.91,
    },
    dataSources: ['dexcom', 'apple-watch'],
    comparison: {
      before: { value: 118, label: 'Before TRE (Aug)' },
      after: { value: 94, label: 'Current (Dec)' },
    },
    whyNow: 'You\'ve maintained your eating window consistently for 90 daysâ€”your glucose is responding.',
    holdoutPreview: {
      metric: 'fasting_glucose',
      expectedChange: -3,
      unit: 'mg/dL',
      horizon: '30 days',
    },
    showWork: 'Over 87 days of CGM data, your fasting glucose dropped from 118 mg/dL to 94 mg/dL. The improvement accelerated after 6 weeks of consistent 8-hour eating windows. Your glucose variability also decreased by 40%, indicating improved metabolic flexibility. This matches research showing TRE benefits compound over time.',
  },
  {
    id: 'sarah-insight-002',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'outcome',  // Glucose spike is a daily response
    title: 'POST-MEAL WALKS â†’ GLUCOSE SPIKE',
    headline: '15-minute walks are cutting your glucose spikes in half',
    recommendation: 'Walk for 15 min after meals',
    explanation: 'Post-meal movement reduces glucose spike by 28 mg/dL',
    cause: {
      behavior: 'post_meal_walk',
      threshold: 15,
      unit: 'minutes',
      direction: 'above',
    },
    populationThreshold: {
      value: '20 mg/dL',
      label: 'Population Avg Reduction',
      variance: 'Your response is 40% stronger than average',
    },
    outcome: {
      metric: 'glucose_spike',
      effect: '-28 mg/dL peak reduction',
      direction: 'positive',
    },
    certainty: 0.88,
    evidence: {
      personalDays: 65,
      personalWeight: 0.88,
      populationWeight: 0.12,
      stability: 0.85,
    },
    dataSources: ['dexcom', 'apple-watch'],
    comparison: {
      before: { value: 156, label: 'No walk post-meal' },
      after: { value: 128, label: 'With 15-min walk' },
    },
    whyNow: 'CGM data shows clear pattern on walk vs. no-walk days.',
    holdoutPreview: {
      metric: 'time_in_range',
      expectedChange: 8,
      unit: '%',
      horizon: '14 days',
    },
    showWork: 'Comparing 42 meals followed by walks vs. 38 meals without, your average glucose peak was 128 mg/dL vs. 156 mg/dL. The effect is most pronounced after carb-heavy meals. Your personal response is stronger than the population average (28 mg/dL vs. 20 mg/dL reduction).',
  },
  {
    id: 'sarah-insight-003',
    personaId: 'sarah',
    category: 'sleep',
    variableType: 'outcome',  // Sleep quality is a daily outcome
    title: 'CAFFEINE TIMING â†’ SLEEP QUALITY',
    headline: 'Your caffeine cutoff can be later than average',
    recommendation: 'Caffeine is fine until 4:30 PM for you',
    explanation: 'You metabolize caffeine fasterâ€”no sleep impact until after 4:30 PM',
    cause: {
      behavior: 'caffeine_cutoff',
      threshold: '16:30',
      unit: 'time',
      direction: 'before',
    },
    populationThreshold: {
      value: '14:00',
      label: 'Population Average',
      variance: '2.5 hours later than average',
    },
    outcome: {
      metric: 'sleep_quality',
      effect: 'No degradation until after 4:30 PM',
      direction: 'positive',
    },
    certainty: 0.79,
    evidence: {
      personalDays: 72,
      personalWeight: 0.79,
      populationWeight: 0.21,
      stability: 0.74,
    },
    dataSources: ['oura'],
    comparison: {
      before: { value: 78, label: 'Caffeine at 5 PM' },
      after: { value: 82, label: 'Caffeine before 4:30 PM' },
    },
    whyNow: 'Your personalized threshold differs from the population average (2:00 PM).',
    showWork: 'Analysis of your 72 days with caffeine tracking shows no significant sleep quality difference when caffeine is consumed before 4:30 PM. After 5 PM, your sleep score drops by 4 points on average. Your threshold is 2.5 hours later than the population average, suggesting faster caffeine metabolism.',
  },
  {
    id: 'sarah-insight-004',
    personaId: 'sarah',
    category: 'cardio',
    variableType: 'outcome',  // HRV stability is a recovery outcome
    title: 'HRV TREND â†’ RECOVERY STATUS',
    headline: 'Your HRV consistency indicates excellent recovery',
    recommendation: 'Maintain current recovery practices',
    explanation: 'Your HRV variability is 40% lower than baseline, showing adaptation',
    cause: {
      behavior: 'recovery_practices',
      threshold: 0,
      unit: 'composite',
      direction: 'above',
    },
    populationThreshold: {
      value: '52 ms',
      label: 'Avg for Your Age',
      variance: 'Your HRV is in the top 20% for your demographic',
    },
    outcome: {
      metric: 'hrv_stability',
      effect: 'Day-to-day variance reduced 40%',
      direction: 'positive',
    },
    certainty: 0.85,
    evidence: {
      personalDays: 90,
      personalWeight: 0.85,
      populationWeight: 0.15,
      stability: 0.88,
    },
    dataSources: ['oura'],
    comparison: {
      before: { value: 18, label: 'HRV variance (Aug)' },
      after: { value: 11, label: 'HRV variance (Dec)' },
    },
    whyNow: 'Three months of consistent data shows your recovery has stabilized.',
    showWork: 'Your HRV standard deviation dropped from 18ms to 11ms over 90 days while your average HRV increased from 44ms to 52ms. Lower day-to-day variance combined with higher baseline indicates improved autonomic regulation and recovery capacity.',
  },
  {
    id: 'sarah-insight-005',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'outcome',  // Time in range is a daily outcome
    title: 'SLEEP DURATION â†’ TIME IN RANGE',
    headline: 'Sleep under 7 hours spikes your glucose the next day',
    recommendation: 'Prioritize 7.5+ hours of sleep',
    explanation: 'Short sleep reduces your time-in-range by 15%',
    cause: {
      behavior: 'sleep_duration',
      threshold: 7,
      unit: 'hours',
      direction: 'above',
    },
    populationThreshold: {
      value: 6.5,
      label: 'Population Average Need',
      variance: 'You need 30 min more than average',
    },
    outcome: {
      metric: 'time_in_range',
      effect: '-15% when sleep is under 7 hours',
      direction: 'negative',
    },
    certainty: 0.86,
    evidence: {
      personalDays: 82,
      personalWeight: 0.86,
      populationWeight: 0.14,
      stability: 0.82,
    },
    dataSources: ['oura', 'dexcom'],
    comparison: {
      before: { value: 72, label: '<7 hrs sleep' },
      after: { value: 87, label: '7.5+ hrs sleep' },
    },
    whyNow: 'Cross-referencing your sleep and CGM data reveals this pattern.',
    holdoutPreview: {
      metric: 'time_in_range',
      expectedChange: 5,
      unit: '%',
      horizon: '7 days',
    },
    showWork: 'On 24 nights with less than 7 hours of sleep, your next-day time-in-range averaged 72%. On 58 nights with 7.5+ hours, it averaged 87%. The effect is most pronounced in the morning hours, suggesting sleep impacts your dawn phenomenon response.',
  },
  // BLOOD BIOMARKER INSIGHTS
  {
    id: 'sarah-insight-006',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // HbA1c is a slow-changing biomarker (3-month average)
    title: 'TIME-RESTRICTED EATING â†’ HBA1C',
    headline: 'Your HbA1c dropped from pre-diabetic to optimal range',
    recommendation: 'Continue 8-hour eating window for HbA1c maintenance',
    explanation: 'HbA1c improved 0.6% in 4 months',
    causalParams: {
      source: 'eating_window_hours',
      target: 'hba1c_pct',
      curveType: 'plateau_down',
      theta: {
        value: 8,
        unit: 'hours',
        low: 7,
        high: 9,
        displayValue: '8 hours',
      },
      betaBelow: {
        value: -0.05,
        unit: '%',
        description: '-0.05% per hour shorter',
      },
      betaAbove: {
        value: 0.12,
        unit: '%',
        description: '+0.12% per hour longer',
      },
      observations: 4,
      completePct: 100,
      changepointProb: 0.95,
      sizeCategory: 'large',
      currentValue: 8,
      currentStatus: 'at_optimal',
    },
    cause: {
      behavior: 'eating_window',
      threshold: 8,
      unit: 'hours',
      direction: 'below',
    },
    outcome: {
      metric: 'hba1c',
      effect: '-0.6% over 4 months',
      direction: 'positive',
    },
    certainty: 0.96,
    evidence: {
      personalDays: 120,
      personalWeight: 0.82,
      populationWeight: 0.18,
      stability: 0.94,
    },
    dataSources: ['Vitals+-app', 'bloodwork'],
    comparison: {
      before: { value: 5.9, label: 'Aug (pre-TRE)' },
      after: { value: 5.3, label: 'Dec (4 months TRE)' },
    },
    whyNow: 'Your HbA1c dropped from 5.9% to 5.3%â€”out of pre-diabetic range.',
    holdoutPreview: {
      metric: 'hba1c',
      expectedChange: -0.1,
      unit: '%',
      horizon: '12 weeks',
    },
    showWork: 'Four consecutive lab draws show steady HbA1c improvement: 5.9% â†’ 5.7% â†’ 5.5% â†’ 5.3%. The 0.6% total reduction correlates perfectly with your consistent 8-hour eating window. Population research supports TRE for glycemic control, but your response is stronger than average.',
    actionable: true,
    priority: 1,
  },
  {
    id: 'sarah-insight-007',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // Triglycerides are a slow-changing biomarker
    title: 'LIFESTYLE CHANGES â†’ TRIGLYCERIDES',
    headline: 'Your triglycerides dropped 33% without medication',
    recommendation: 'Continue current lifestyle protocol',
    explanation: 'Triglycerides improved from 168 to 112 mg/dL',
    causalParams: {
      source: 'combined_lifestyle_score',
      target: 'triglycerides_mgdl',
      curveType: 'linear',
      theta: {
        value: 80,
        unit: 'score',
        low: 70,
        high: 90,
        displayValue: '80+ lifestyle score',
      },
      betaBelow: {
        value: 8,
        unit: 'mg/dL',
        description: '+8 mg/dL per point lower',
      },
      betaAbove: {
        value: -4,
        unit: 'mg/dL',
        description: '-4 mg/dL per point higher',
      },
      observations: 4,
      completePct: 100,
      changepointProb: 0.93,
      sizeCategory: 'large',
      currentValue: 85,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'lifestyle_composite',
      threshold: 80,
      unit: 'score',
      direction: 'above',
    },
    outcome: {
      metric: 'triglycerides',
      effect: '-56 mg/dL over 4 months',
      direction: 'positive',
    },
    certainty: 0.94,
    evidence: {
      personalDays: 120,
      personalWeight: 0.78,
      populationWeight: 0.22,
      stability: 0.91,
    },
    dataSources: ['bloodwork', 'Vitals+-app', 'oura'],
    comparison: {
      before: { value: 168, label: 'Aug baseline' },
      after: { value: 112, label: 'Dec current' },
    },
    whyNow: 'Your triglycerides are now in optimal range (<150 mg/dL).',
    holdoutPreview: {
      metric: 'triglycerides',
      expectedChange: -8,
      unit: 'mg/dL',
      horizon: '8 weeks',
    },
    showWork: 'Your triglyceride improvement tracks with multiple lifestyle changes: time-restricted eating, regular post-meal walks, reduced alcohol, and improved sleep. The combined effect exceeds what any single intervention would achieve. Your trajectory suggests continued improvement.',
    actionable: true,
    priority: 1,
  },
  {
    id: 'sarah-insight-008',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // HDL cholesterol is a slow-changing biomarker
    title: 'HDL IMPROVEMENT â†’ CARDIOVASCULAR RISK',
    headline: 'Your HDL increased 25% from lifestyle changes',
    recommendation: 'Add 2 servings fatty fish per week for further HDL boost',
    explanation: 'HDL improved from 48 to 60 mg/dL',
    causalParams: {
      source: 'weekly_exercise_minutes',
      target: 'hdl_mgdl',
      curveType: 'plateau_up',
      theta: {
        value: 150,
        unit: 'min/week',
        low: 120,
        high: 180,
        displayValue: '150 min/week',
      },
      betaBelow: {
        value: 0.5,
        unit: 'mg/dL',
        description: '+0.5 mg/dL per 10min more',
      },
      betaAbove: {
        value: 0.15,
        unit: 'mg/dL',
        description: '+0.15 mg/dL per 10min (diminishing)',
      },
      observations: 4,
      completePct: 100,
      changepointProb: 0.88,
      sizeCategory: 'medium',
      currentValue: 180,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'exercise_frequency',
      threshold: 150,
      unit: 'minutes/week',
      direction: 'above',
    },
    outcome: {
      metric: 'hdl_cholesterol',
      effect: '+12 mg/dL over 4 months',
      direction: 'positive',
    },
    certainty: 0.91,
    evidence: {
      personalDays: 120,
      personalWeight: 0.72,
      populationWeight: 0.28,
      stability: 0.87,
    },
    dataSources: ['bloodwork', 'oura', 'apple-watch'],
    comparison: {
      before: { value: 48, label: 'Aug (low)' },
      after: { value: 60, label: 'Dec (optimal)' },
    },
    whyNow: 'Your HDL crossed the 60 mg/dL thresholdâ€”now cardioprotective.',
    holdoutPreview: {
      metric: 'hdl_cholesterol',
      expectedChange: 2,
      unit: 'mg/dL',
      horizon: '8 weeks',
    },
    showWork: 'HDL increase correlates with your consistent exercise routine (averaging 180 min/week). Your HDL:LDL ratio improved from 0.36 to 0.61. Combined with triglyceride reduction, your cardiovascular risk profile improved substantially.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'sarah-insight-009',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // hsCRP is a slow-changing inflammation marker
    title: 'INFLAMMATION REDUCTION â†’ HSCRP',
    headline: 'Your inflammation marker dropped 63%',
    recommendation: 'Maintain anti-inflammatory lifestyle practices',
    explanation: 'hsCRP improved from 2.4 to 0.9 mg/L',
    causalParams: {
      source: 'metabolic_health_score',
      target: 'hscrp_mgl',
      curveType: 'plateau_down',
      theta: {
        value: 75,
        unit: 'score',
        low: 65,
        high: 85,
        displayValue: '75+ score',
      },
      betaBelow: {
        value: 0.15,
        unit: 'mg/L',
        description: '+0.15 mg/L per point lower',
      },
      betaAbove: {
        value: -0.08,
        unit: 'mg/L',
        description: '-0.08 mg/L per point higher',
      },
      observations: 4,
      completePct: 100,
      changepointProb: 0.92,
      sizeCategory: 'large',
      currentValue: 85,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'metabolic_health',
      threshold: 75,
      unit: 'score',
      direction: 'above',
    },
    outcome: {
      metric: 'hscrp',
      effect: '-1.5 mg/L over 4 months',
      direction: 'positive',
    },
    certainty: 0.93,
    evidence: {
      personalDays: 120,
      personalWeight: 0.75,
      populationWeight: 0.25,
      stability: 0.89,
    },
    dataSources: ['bloodwork'],
    comparison: {
      before: { value: 2.4, label: 'Aug (elevated)' },
      after: { value: 0.9, label: 'Dec (optimal)' },
    },
    whyNow: 'Your hsCRP is now in optimal range (<1.0 mg/L), indicating low systemic inflammation.',
    holdoutPreview: {
      metric: 'hscrp',
      expectedChange: -0.1,
      unit: 'mg/L',
      horizon: '8 weeks',
    },
    showWork: 'hsCRP reduction parallels your metabolic improvements. Improved glucose control, weight management, and reduced visceral fat all contribute to lower inflammation. Your 63% reduction exceeds typical lifestyle intervention results.',
    actionable: true,
    priority: 1,
  },
  {
    id: 'sarah-insight-010',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // Vitamin D level is a slow-changing biomarker
    title: 'VITAMIN D OPTIMIZATION â†’ MULTIPLE MARKERS',
    headline: 'Vitamin D supplementation is supporting your metabolic health',
    recommendation: 'Continue 4000 IU Vitamin D3 daily',
    explanation: 'Vitamin D increased from 28 to 48 ng/mL',
    causalParams: {
      source: 'daily_vitamin_d_iu',
      target: 'vitamin_d_ngml',
      curveType: 'plateau_up',
      theta: {
        value: 4000,
        unit: 'IU',
        low: 3000,
        high: 5000,
        displayValue: '4000 IU daily',
      },
      betaBelow: {
        value: 0.8,
        unit: 'ng/mL',
        description: '+0.8 ng/mL per 500 IU more',
      },
      betaAbove: {
        value: 0.2,
        unit: 'ng/mL',
        description: '+0.2 ng/mL per 500 IU (diminishing)',
      },
      observations: 4,
      completePct: 100,
      changepointProb: 0.90,
      sizeCategory: 'medium',
      currentValue: 4000,
      currentStatus: 'at_optimal',
    },
    cause: {
      behavior: 'vitamin_d_supplementation',
      threshold: 4000,
      unit: 'IU',
      direction: 'above',
    },
    outcome: {
      metric: 'vitamin_d',
      effect: '+20 ng/mL over 4 months',
      direction: 'positive',
    },
    certainty: 0.89,
    evidence: {
      personalDays: 120,
      personalWeight: 0.55,
      populationWeight: 0.45,
      stability: 0.86,
    },
    dataSources: ['bloodwork', 'Vitals+-app'],
    comparison: {
      before: { value: 28, label: 'Aug (insufficient)' },
      after: { value: 48, label: 'Dec (optimal)' },
    },
    whyNow: 'Your Vitamin D reached optimal range (40-60 ng/mL).',
    holdoutPreview: {
      metric: 'vitamin_d',
      expectedChange: 2,
      unit: 'ng/mL',
      horizon: '8 weeks',
    },
    showWork: 'Vitamin D insufficiency is linked to insulin resistance. Your improvement from 28 to 48 ng/mL coincided with improved insulin sensitivity. Population research suggests Vitamin D supports glucose metabolism, which your data confirms.',
    actionable: true,
    priority: 2,
  },
  {
    id: 'sarah-insight-011',
    personaId: 'sarah',
    category: 'metabolic',
    variableType: 'marker',  // LDL cholesterol is a slow-changing biomarker
    title: 'LDL REDUCTION â†’ CARDIOVASCULAR RISK',
    headline: 'Your LDL dropped 34 points from lifestyle alone',
    recommendation: 'Add 10g soluble fiber daily for additional LDL reduction',
    explanation: 'LDL improved from 132 to 98 mg/dL',
    causalParams: {
      source: 'dietary_fiber_g',
      target: 'ldl_mgdl',
      curveType: 'plateau_down',
      theta: {
        value: 25,
        unit: 'grams',
        low: 20,
        high: 30,
        displayValue: '25g fiber/day',
      },
      betaBelow: {
        value: 3,
        unit: 'mg/dL',
        description: '+3 mg/dL per 5g less fiber',
      },
      betaAbove: {
        value: -2,
        unit: 'mg/dL',
        description: '-2 mg/dL per 5g more fiber',
      },
      observations: 4,
      completePct: 100,
      changepointProb: 0.91,
      sizeCategory: 'large',
      currentValue: 28,
      currentStatus: 'above_optimal',
    },
    cause: {
      behavior: 'dietary_fiber',
      threshold: 25,
      unit: 'grams',
      direction: 'above',
    },
    outcome: {
      metric: 'ldl_cholesterol',
      effect: '-34 mg/dL over 4 months',
      direction: 'positive',
    },
    certainty: 0.92,
    evidence: {
      personalDays: 120,
      personalWeight: 0.68,
      populationWeight: 0.32,
      stability: 0.88,
    },
    dataSources: ['bloodwork', 'Vitals+-app'],
    comparison: {
      before: { value: 132, label: 'Aug (elevated)' },
      after: { value: 98, label: 'Dec (optimal)' },
    },
    whyNow: 'Your LDL dropped below 100 mg/dLâ€”now in optimal range.',
    holdoutPreview: {
      metric: 'ldl_cholesterol',
      expectedChange: -5,
      unit: 'mg/dL',
      horizon: '8 weeks',
    },
    showWork: 'Your LDL reduction correlates with increased fiber intake, time-restricted eating, and improved metabolic health. The 26% reduction without medication is exceptional. Adding soluble fiber (oats, beans) could push LDL even lower.',
    actionable: true,
    priority: 2,
  },
]

// Generate 90 days of metrics for Sarah - improvement arc
function generateSarahMetrics(): DailyMetrics[] {
  const metrics: DailyMetrics[] = []
  const startDate = new Date('2024-09-15')

  for (let i = 0; i < 90; i++) {
    const date = new Date(startDate)
    date.setDate(date.getDate() + i)
    const dateStr = date.toISOString().split('T')[0]

    // Improvement arc: steady improvement over 90 days
    const improvementFactor = i / 90  // 0 to 1

    // Glucose improves over time
    const baseGlucose = 118 - (improvementFactor * 24)

    // Sleep improves as metabolic health improves
    const baseSleepScore = 72 + (improvementFactor * 10)

    // HRV improves
    const baseHrv = 44 + (improvementFactor * 8)

    const metric: DailyMetrics = {
      date: dateStr,
      sleepScore: Math.round(baseSleepScore + Math.random() * 8 - 4),
      sleepDuration: Math.round(420 + Math.random() * 60),
      deepSleep: Math.round(48 + improvementFactor * 10 + Math.random() * 10),
      remSleep: Math.round(85 + Math.random() * 20),
      lightSleep: Math.round(220 + Math.random() * 40),
      sleepLatency: Math.round(12 - improvementFactor * 4 + Math.random() * 5),
      sleepEfficiency: 0.85 + improvementFactor * 0.05 + Math.random() * 0.05,
      bedtime: `22:${Math.floor(Math.random() * 30).toString().padStart(2, '0')}`,
      wakeTime: `06:${Math.floor(15 + Math.random() * 30).toString().padStart(2, '0')}`,
      hrv: Math.round(baseHrv + Math.random() * 10),
      restingHr: Math.round(58 - improvementFactor * 4 + Math.random() * 4),
      respiratoryRate: 13 + Math.random() * 1,
      bodyTemp: -0.1 + Math.random() * 0.3,
      steps: Math.round(8000 + Math.random() * 4000),
      activeCalories: Math.round(300 + Math.random() * 200),
      moderateMinutes: Math.round(30 + Math.random() * 20),
      vigorousMinutes: Math.round(10 + Math.random() * 15),
      zone2Minutes: Math.round(20 + Math.random() * 25),
      trainingLoad: Math.round(50 + Math.random() * 30),
      caffeineCutoff: `${14 + Math.floor(Math.random() * 3)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}`,
      alcoholUnits: Math.random() > 0.85 ? 1 : 0,
      eatingWindowStart: '10:00',
      eatingWindowEnd: '18:00',
      bedroomTemp: 18 + Math.random() * 1.5,
      workoutTime: Math.random() > 0.2 ? `${17 + Math.floor(Math.random() * 3)}:${Math.floor(Math.random() * 60).toString().padStart(2, '0')}` : null,
      workoutType: Math.random() > 0.2 ? ['strength', 'yoga', 'cardio', 'walking'][Math.floor(Math.random() * 4)] : null,
      mood: Math.round(5 + improvementFactor + Math.random()),
      energy: Math.round(5 + improvementFactor + Math.random()),
      focus: Math.round(5 + improvementFactor * 0.5 + Math.random()),
      stress: Math.round(4 - improvementFactor + Math.random()),
    }

    metrics.push(metric)
  }

  return metrics
}

export const sarahMetrics: DailyMetrics[] = generateSarahMetrics()

export const sarahLabs: LabResult[] = [
  {
    date: '2024-08-01',
    fastingGlucose: 118,
    hba1c: 5.9,
    totalCholesterol: 210,
    ldl: 132,
    hdl: 48,
    triglycerides: 168,
    hsCrp: 2.4,
    vitaminD: 28,
  },
  {
    date: '2024-09-15',
    fastingGlucose: 112,
    hba1c: 5.7,
    totalCholesterol: 198,
    ldl: 122,
    hdl: 52,
    triglycerides: 148,
    hsCrp: 1.9,
    vitaminD: 35,
  },
  {
    date: '2024-11-01',
    fastingGlucose: 102,
    hba1c: 5.5,
    totalCholesterol: 185,
    ldl: 108,
    hdl: 56,
    triglycerides: 128,
    hsCrp: 1.4,
    vitaminD: 42,
  },
  {
    date: '2024-12-15',
    fastingGlucose: 94,
    hba1c: 5.3,
    totalCholesterol: 178,
    ldl: 98,
    hdl: 60,
    triglycerides: 112,
    hsCrp: 0.9,
    vitaminD: 48,
  },
]

export const sarahProtocols: Protocol[] = [
  {
    id: 'sarah-protocol-glucose',
    personaId: 'sarah',
    name: 'Glucose Optimization Protocol',
    description: 'Maximize time-in-range through meal timing and movement',
    category: 'metabolic',
    status: 'active',
    outcome: 'time_in_range',
    baseline: {
      value: 0.72,
      unit: '%',
    },
    actions: [
      {
        id: 'action-eating-start',
        label: 'Start eating at 10:00 AM',
        category: 'metabolic',
        isActive: true,
        impact: 0.04,
        actionType: 'cutoff',
        time: '10:00 AM',
        linkedInsightId: 'sarah-insight-001',
      },
      {
        id: 'action-eating-end',
        label: 'Last meal by 6:00 PM',
        category: 'metabolic',
        isActive: true,
        impact: 0.04,
        actionType: 'cutoff',
        time: '6:00 PM',
        linkedInsightId: 'sarah-insight-001',
      },
      {
        id: 'action-post-meal-walk',
        label: '15-min walk after meals',
        category: 'metabolic',
        isActive: true,
        impact: 0.06,
        actionType: 'duration',
        linkedInsightId: 'sarah-insight-002',
      },
      {
        id: 'action-sleep-priority',
        label: 'Get 7.5+ hours sleep',
        category: 'sleep',
        isActive: true,
        impact: 0.05,
        actionType: 'target',
        linkedInsightId: 'sarah-insight-005',
      },
      {
        id: 'action-protein-first',
        label: 'Eat protein before carbs',
        category: 'nutrition',
        isActive: false,
        impact: 0.03,
        actionType: 'target',
      },
    ],
    states: [
      { id: 'state-stress', label: 'High stress day', isActive: false },
      { id: 'state-period', label: 'Menstrual cycle day 1-5', isActive: false },
    ],
    triggers: [
      {
        if: ['state-stress'],
        then: ['action-post-meal-walk', 'action-sleep-priority'],
        reason: 'Stress hormones elevate glucoseâ€”prioritize movement and sleep',
      },
    ],
    simulator: {
      deltas: {
        'action-eating-start': 0.04,
        'action-eating-end': 0.04,
        'action-post-meal-walk': 0.06,
        'action-sleep-priority': 0.05,
        'action-protein-first': 0.03,
      },
    },
    evidenceLevel: 93,
    difficulty: 2,
  },
  {
    id: 'sarah-protocol-metabolic-reversal',
    personaId: 'sarah',
    name: 'Metabolic Health Protocol',
    description: 'Continue reversing pre-diabetic markers through lifestyle',
    category: 'metabolic',
    status: 'active',
    outcome: 'hba1c',
    baseline: {
      value: 5.3,
      unit: '%',
    },
    actions: [
      {
        id: 'action-tre-8hr',
        label: '8-hour eating window daily',
        category: 'metabolic',
        isActive: true,
        impact: -0.15,
        actionType: 'duration',
        linkedInsightId: 'sarah-insight-006',
      },
      {
        id: 'action-fiber-25g',
        label: '25g+ fiber daily',
        category: 'nutrition',
        isActive: true,
        impact: -0.08,
        actionType: 'target',
        linkedInsightId: 'sarah-insight-011',
      },
      {
        id: 'action-vitamin-d',
        label: '4000 IU Vitamin D3 daily',
        category: 'metabolic',
        isActive: true,
        impact: -0.05,
        actionType: 'target',
        linkedInsightId: 'sarah-insight-010',
      },
      {
        id: 'action-weekly-exercise',
        label: '150+ min exercise weekly',
        category: 'activity',
        isActive: true,
        impact: -0.1,
        actionType: 'duration',
        linkedInsightId: 'sarah-insight-008',
      },
    ],
    states: [
      { id: 'state-vacation', label: 'On vacation', isActive: false },
    ],
    triggers: [
      {
        if: ['state-vacation'],
        then: ['action-tre-8hr'],
        reason: 'Maintain eating window even on vacationâ€”it\'s the most impactful',
      },
    ],
    simulator: {
      deltas: {
        'action-tre-8hr': -0.15,
        'action-fiber-25g': -0.08,
        'action-vitamin-d': -0.05,
        'action-weekly-exercise': -0.1,
      },
    },
    evidenceLevel: 94,
    difficulty: 3,
  },
  {
    id: 'sarah-protocol-lipids',
    personaId: 'sarah',
    name: 'Lipid Optimization Protocol',
    description: 'Maintain and improve lipid panel through diet and exercise',
    category: 'cardio',
    status: 'active',
    outcome: 'ldl_cholesterol',
    baseline: {
      value: 98,
      unit: 'mg/dL',
    },
    actions: [
      {
        id: 'action-soluble-fiber',
        label: '10g soluble fiber daily',
        category: 'nutrition',
        isActive: true,
        impact: -8,
        actionType: 'target',
        linkedInsightId: 'sarah-insight-011',
      },
      {
        id: 'action-fatty-fish',
        label: '2 servings fatty fish weekly',
        category: 'nutrition',
        isActive: false,
        impact: -5,
        actionType: 'target',
        linkedInsightId: 'sarah-insight-008',
      },
      {
        id: 'action-cardio-150',
        label: '150+ min cardio weekly',
        category: 'activity',
        isActive: true,
        impact: -6,
        actionType: 'duration',
        linkedInsightId: 'sarah-insight-008',
      },
    ],
    states: [],
    triggers: [],
    simulator: {
      deltas: {
        'action-soluble-fiber': -8,
        'action-fatty-fish': -5,
        'action-cardio-150': -6,
      },
    },
    evidenceLevel: 91,
    difficulty: 2,
  },
  {
    id: 'sarah-protocol-sleep',
    personaId: 'sarah',
    name: 'Sleep Quality Protocol',
    description: 'Optimize sleep for metabolic health',
    category: 'sleep',
    status: 'suggested',
    outcome: 'sleep_score',
    baseline: {
      value: 82,
      unit: 'score',
    },
    actions: [
      {
        id: 'action-caffeine-cutoff',
        label: 'No caffeine after 4:30 PM',
        category: 'sleep',
        isActive: true,
        impact: 3,
        actionType: 'cutoff',
        time: '4:30 PM',
        linkedInsightId: 'sarah-insight-003',
      },
      {
        id: 'action-bedtime',
        label: 'In bed by 10:30 PM',
        category: 'sleep',
        isActive: true,
        impact: 4,
        actionType: 'cutoff',
        time: '10:30 PM',
      },
      {
        id: 'action-bedroom-temp',
        label: 'Set bedroom to 19Â°C',
        category: 'sleep',
        isActive: false,
        impact: 2,
        actionType: 'target',
      },
    ],
    states: [],
    triggers: [],
    simulator: {
      deltas: {
        'action-caffeine-cutoff': 3,
        'action-bedtime': 4,
        'action-bedroom-temp': 2,
      },
    },
    evidenceLevel: 85,
    difficulty: 1,
  },
]

export const sarahDailyPlan: DailyPlan = {
  personaId: 'sarah',
  date: new Date().toISOString().split('T')[0],
  greeting: 'Good morning, Sarah! Your time-in-range was 89% yesterdayâ€”you\'re crushing it.',
  priorities: {
    high: [
      {
        id: 'plan-001',
        text: 'Start eating window at 10 AM',
        explanation: 'Your 8-hour window is key to your glucose improvements',
        evidenceWeight: '93% your data, 7% population',
        status: 'pending',
      },
    ],
    moderate: [
      {
        id: 'plan-002',
        text: '15-min walk after lunch',
        explanation: 'Cuts your post-meal spike by 28 mg/dL on average',
        evidenceWeight: '88% your data, 12% population',
        status: 'pending',
      },
      {
        id: 'plan-003',
        text: 'Close eating window by 6 PM',
        explanation: 'Late eating increases your overnight glucose by 12 mg/dL',
        evidenceWeight: '82% your data, 18% population',
        status: 'pending',
      },
    ],
    maintain: [
      {
        id: 'plan-004',
        text: 'Get to bed by 10:30 PM',
        explanation: 'Your glucose tomorrow depends on tonight\'s sleep',
        evidenceWeight: '86% your data, 14% population',
        status: 'pending',
      },
    ],
  },
  eveningCheckIn: {
    completed: [],
    pending: [],
    prediction: {
      sleepScore: 84,
      deepSleep: 56,
      sleepLatency: 8,
      confidence: 0.82,
    },
  },
}
